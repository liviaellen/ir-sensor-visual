{
  "version": 3,
  "sources": ["../../src/React/index.tsx"],
  "sourcesContent": ["import { AttachType } from \"@react-three/fiber/dist/declarations/src/core/renderer\";\r\nimport * as React from \"react\";\r\nimport { Material } from \"three\";\r\nimport CustomShaderMaterialImpl, { MaterialConstructor } from \"../index\";\r\nimport { CustomShaderMaterialProps } from \"./types\";\r\n\r\nfunction useDidUpdateEffect(\r\n  fn: (...opts: any[]) => any,\r\n  inputs: React.DependencyList\r\n) {\r\n  const didMountRef = React.useRef(false);\r\n\r\n  React.useEffect(() => {\r\n    if (didMountRef.current) {\r\n      return fn();\r\n    }\r\n    didMountRef.current = true;\r\n  }, inputs);\r\n}\r\n\r\nfunction CustomShaderMaterial<T extends MaterialConstructor>(\r\n  {\r\n    baseMaterial,\r\n    vertexShader,\r\n    fragmentShader,\r\n    uniforms,\r\n    cacheKey,\r\n    patchMap,\r\n    attach,\r\n    ...opts\r\n  }: CustomShaderMaterialProps<T>,\r\n  ref: React.Ref<InstanceType<T>>\r\n) {\r\n  const material = React.useMemo(() => {\r\n    return new CustomShaderMaterialImpl({\r\n      baseMaterial,\r\n      vertexShader,\r\n      fragmentShader,\r\n      uniforms,\r\n      cacheKey,\r\n      patchMap,\r\n      ...opts,\r\n    });\r\n  }, [baseMaterial]);\r\n\r\n  useDidUpdateEffect(() => {\r\n    material.dispose();\r\n    material.update({\r\n      vertexShader,\r\n      fragmentShader,\r\n      uniforms,\r\n      patchMap,\r\n      cacheKey,\r\n    });\r\n  }, [vertexShader, fragmentShader, uniforms, patchMap, cacheKey]);\r\n\r\n  React.useEffect(() => () => material.dispose(), [material]);\r\n\r\n  return (\r\n    <primitive\r\n      ref={ref}\r\n      attach={attach ?? \"material\"}\r\n      object={material}\r\n      {...opts}\r\n    />\r\n  );\r\n}\r\n\r\n// export default React.forwardRef(CustomShaderMaterial) as <\r\n//   T extends MaterialConstructor\r\n// >(\r\n//   props: CustomShaderMaterialProps<T> & { ref?: React.Ref<InstanceType<T>> }\r\n// ) => React.ReactElement;\r\n\r\nexport default React.forwardRef(CustomShaderMaterial) as <\r\n  T extends MaterialConstructor = typeof Material\r\n>(\r\n  props: CustomShaderMaterialProps<T> & {\r\n    ref?: React.Ref<CustomShaderMaterialImpl<T>>;\r\n    attach?: AttachType;\r\n  }\r\n) => React.ReactElement;\r\n\r\nexport { type CustomShaderMaterialProps } from \"./types\";\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAMA,SAASA,EACPC,GACAC,GACA;AACM,QAAAC,IAAoB,SAAO,KAAK;AAEtCC,EAAM,YAAU,MAAM;AACpB,QAAID,EAAY;AACd,aAAOF,EAAG;AAEZE,MAAY,UAAU;EAAA,GACrBD,CAAM;AACX;AAEA,SAASG,EACP;EACE,cAAAC;EACA,cAAAC;EACA,gBAAAC;EACA,UAAAC;EACA,UAAAC;EACA,UAAAC;EACA,QAAAC;EACA,GAAGC;AACL,GACAC,GACA;AACM,QAAAC,IAAiB,UAAQ,MACtB,IAAIC,EAAyB;IAClC,cAAAV;IACA,cAAAC;IACA,gBAAAC;IACA,UAAAC;IACA,UAAAC;IACA,UAAAC;IACA,GAAGE;EAAA,CACJ,GACA,CAACP,CAAY,CAAC;AAEjB,SAAAN,EAAmB,MAAM;AACvBe,MAAS,QAAQ,GACjBA,EAAS,OAAO;MACd,cAAAR;MACA,gBAAAC;MACA,UAAAC;MACA,UAAAE;MACA,UAAAD;IAAA,CACD;EAAA,GACA,CAACH,GAAcC,GAAgBC,GAAUE,GAAUD,CAAQ,CAAC,GAEzD,YAAU,MAAM,MAAMK,EAAS,QAAW,GAAA,CAACA,CAAQ,CAAC,OAGxDE,mBAAAA;IAAC;IAAA;MACC,KAAAH;MACA,QAAQF,KAAU;MAClB,QAAQG;MACP,GAAGF;IAAA;EACN;AAEJ;AAQA,IAAAK,KAAqB,aAAWb,CAAoB;",
  "names": ["useDidUpdateEffect", "fn", "inputs", "didMountRef", "React", "CustomShaderMaterial", "baseMaterial", "vertexShader", "fragmentShader", "uniforms", "cacheKey", "patchMap", "attach", "opts", "ref", "material", "CustomShaderMaterialImpl", "jsx", "index"]
}
