import {
  $,
  B,
  C,
  F,
  M,
  N,
  O,
  S,
  ae,
  de,
  j,
  ne,
  q,
  ve
} from "./chunk-V2AHPT5P.js";
import {
  LevaPanel,
  button,
  useControls,
  useCreateStore
} from "./chunk-5NRGK3OG.js";
import "./chunk-3WQTQBUM.js";
import {
  require_client
} from "./chunk-RSZBRKH3.js";
import "./chunk-2RADP4CJ.js";
import {
  extend
} from "./chunk-YQHG363R.js";
import "./chunk-UFORGWNI.js";
import {
  Color,
  TextureLoader
} from "./chunk-PZ6HF7LT.js";
import {
  require_jsx_runtime
} from "./chunk-VTS4FBCU.js";
import {
  require_react
} from "./chunk-6KCF6AHO.js";
import {
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/lamina/lamina.es.js
var import_jsx_runtime = __toESM(require_jsx_runtime());
var import_react = __toESM(require_react());
var import_client = __toESM(require_client());
function N2(e) {
  const t = de[e.constructor], l = new t();
  let r = "";
  return Object.entries(e.properties).forEach(([n, a]) => {
    const i = t["u_" + n] ?? l[n];
    switch (n) {
      case "name":
        a !== e.constructor && (r += ` ${n}={${JSON.stringify(a)}}`);
        break;
      case "visible":
        a || (r += ` ${n}={${JSON.stringify(a)}}`);
        break;
      default:
        a !== i && (r += ` ${n}={${JSON.stringify(a)}}`);
        break;
    }
  }), r;
}
function re(e, t) {
  return `
    <LayerMaterial${N2(t)}>
      ${e.map((n) => {
    const a = N2(n);
    return `<${n.constructor}${a} />`;
  }).join(`
	`)}
    </LayerMaterial>
    `;
}
function J(e) {
  const t = de[e.constructor], l = new t();
  let r = "	";
  return Object.entries(e.properties).forEach(([a, i], d) => {
    var L;
    const g = `
		`;
    if (a.includes("color")) {
      const $2 = typeof i == "string" ? i : "#" + i.getHexString();
      r += `${a}: ${JSON.stringify($2)},${g}`;
    } else {
      const $2 = (L = t["u_" + a]) != null ? L : l[a];
      switch (a) {
        case "name":
          i !== e.constructor && (r += `${a}: ${JSON.stringify(i)},${g}`);
          break;
        case "visible":
          i || (r += `${a}:${JSON.stringify(i)},${g}`);
          break;
        default:
          i !== $2 && (r += `${a}: ${JSON.stringify(i)},${g}`);
          break;
      }
    }
  }), r;
}
function ae2(e, t) {
  const l = J(t), r = `${e.map((a) => `new ${a.constructor}({
      ${J(a)}
      })`).join(`,
		`)}`;
  return `
  new LayerMaterial({
    ${l}
    layers: [
      ${r}
    ]
  })`;
}
extend({
  LayerMaterial: ne
});
function ne2({
  name: e,
  layers: t,
  store: l,
  setUpdate: r
}) {
  return useControls(
    e,
    () => {
      const n = {};
      return t.forEach((a, i) => {
        const d = `${a.label} ~${i}`;
        n[d] = a, n[d].onChange = () => r([`${e}.${d}`, a.label]);
      }), n;
    },
    { store: l },
    [t, e]
  ), null;
}
var de2 = import_react.default.forwardRef(({ children: e, ...t }, l) => {
  var j2, v, M2;
  const r = import_react.default.useRef(null);
  (0, import_react.useImperativeHandle)(l, () => r.current);
  const n = useCreateStore(), [a, i] = import_react.default.useState({}), [d, L] = import_react.default.useState(["", ""]), g = (0, import_react.useMemo)(() => new TextureLoader(), []);
  useControls(
    {
      "Copy JSX": button(() => {
        const c = r.current.layers.map((f) => f.serialize()), o = re(c, r.current.serialize());
        navigator.clipboard.writeText(o);
      }),
      "Copy JS": button(() => {
        const c = r.current.layers.map((f) => f.serialize()), o = ae2(c, r.current.serialize());
        navigator.clipboard.writeText(o);
      })
    },
    { store: n }
  );
  const { Lighting: $2 } = useControls(
    "Base",
    {
      Color: {
        value: "#" + new Color(((j2 = r.current) == null ? void 0 : j2.color) || (t == null ? void 0 : t.color) || "white").convertLinearToSRGB().getHexString(),
        onChange: (c) => {
          r.current.color = c;
        }
      },
      Alpha: {
        value: ((v = r.current) == null ? void 0 : v.alpha) || (t == null ? void 0 : t.alpha) || 1,
        min: 0,
        max: 1,
        onChange: (c) => {
          r.current.alpha = c;
        }
      },
      Lighting: {
        value: ((M2 = r.current) == null ? void 0 : M2.lighting) || (t == null ? void 0 : t.lighting) || "basic",
        options: Object.keys(ae)
      }
    },
    { store: n }
  ), [R, z] = (0, import_react.useMemo)(() => ve({ ...t, lighting: $2 }), [t, $2]);
  return import_react.default.useEffect(() => {
    const c = r.current.layers, o = {};
    c.forEach((f, _) => {
      f.getSchema && (o[`${f.name} ~${_}`] = f.getSchema());
    }), i(o);
  }, [e]), import_react.default.useEffect(() => {
    const o = n.getData()[d[0]];
    if (o) {
      const f = d[0].split("."), _ = parseInt(f[0].split(" ~")[1]), h = d[1], F2 = r.current.layers[_].uuid, b = r.current.uniforms[`u_${F2}_${h}`], y = r.current.layers[_];
      h !== "map" ? (y[h] = o.value, b ? b.value = q(o.value) : (y.buildShaders(y.constructor), r.current.refresh())) : (async () => {
        try {
          if (o.value) {
            const S2 = await g.loadAsync(o.value);
            y[h] = S2, b.value = S2;
          } else
            y[h] = void 0, b.value = void 0;
        } catch (S2) {
          console.error(S2);
        }
      })();
    }
  }, [d]), import_react.default.useLayoutEffect(() => {
    var c;
    r.current.layers = (c = r.current.__r3f.children) == null ? void 0 : c.map((o) => o.object), r.current.refresh();
  }, [e, R]), import_react.default.useLayoutEffect(() => {
    const c = document.body.querySelector("#root"), o = document.createElement("div");
    return c && (c.appendChild(o), (0, import_client.createRoot)(o).render(
      (0, import_jsx_runtime.jsx)(
        LevaPanel,
        {
          titleBar: {
            title: t.name || r.current.name
          },
          store: n
        }
      )
    )), () => {
      o.remove();
    };
  }, [t.name]), (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    Object.entries(a).map(([c, o], f) => (0, import_jsx_runtime.jsx)(ne2, { name: c, layers: o, store: n, setUpdate: L }, `${c} ~${f}`)),
    (0, import_jsx_runtime.jsx)("layerMaterial", { args: [R], ref: r, ...z, children: e })
  ] });
});
extend({
  LayerMaterial: ne,
  Depth_: $,
  Color_: S,
  Noise_: O,
  Fresnel_: M,
  Gradient_: F,
  Matcap_: C,
  Texture_: N,
  Displace_: j,
  Normal_: B
});
var me = import_react.default.forwardRef(({ children: e, ...t }, l) => {
  const r = import_react.default.useRef(null);
  (0, import_react.useImperativeHandle)(l, () => r.current), import_react.default.useLayoutEffect(() => {
    var i;
    r.current.layers = (i = r.current.__r3f.children) == null ? void 0 : i.map((d) => d.object), r.current.refresh();
  }, [e]);
  const [n, a] = (0, import_react.useMemo)(() => ve(t), [t]);
  return (0, import_jsx_runtime.jsx)("layerMaterial", { args: [n], ref: r, ...a, children: e });
});
function m(e) {
  return [
    {
      mode: e == null ? void 0 : e.mode,
      visible: e == null ? void 0 : e.visible,
      type: e == null ? void 0 : e.type,
      mapping: e == null ? void 0 : e.mapping,
      map: e == null ? void 0 : e.map,
      axes: e == null ? void 0 : e.axes
    }
  ];
}
var ge = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("depth_", { args: m(e), ref: t, ...e }));
var $e = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("color_", { ref: t, args: m(e), ...e }));
var he = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("noise_", { ref: t, args: m(e), ...e }));
var ye = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("fresnel_", { ref: t, args: m(e), ...e }));
var Le = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("gradient_", { ref: t, args: m(e), ...e }));
var _e = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("matcap_", { ref: t, args: m(e), ...e }));
var be = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("texture_", { ref: t, args: m(e), ...e }));
var Se = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("displace_", { ref: t, args: m(e), ...e }));
var we = import_react.default.forwardRef((e, t) => (0, import_jsx_runtime.jsx)("normal_", { ref: t, args: m(e), ...e }));
export {
  $e as Color,
  de2 as DebugLayerMaterial,
  ge as Depth,
  Se as Displace,
  ye as Fresnel,
  Le as Gradient,
  me as LayerMaterial,
  _e as Matcap,
  he as Noise,
  we as Normal,
  be as Texture
};
//# sourceMappingURL=lamina.js.map
